System.register("chunks:///_virtual/AudioManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var o,i,u,t,n,r,a,l,c,s,p;return{setters:[function(e){o=e.applyDecoratedDescriptor,i=e.inheritsLoose,u=e.initializerDefineProperty,t=e.assertThisInitialized},function(e){n=e.cclegacy,r=e._decorator,a=e.AudioSource,l=e.AudioClip,c=e.game,s=e.resources,p=e.Component}],execute:function(){var m,d,h,f,S,g,V,b,x,y,w,A,M,k,v,z,P,C,F,G,B,D,_,L,R,W,X;n._RF.push({},"6e9bdoVGDFGy5go97L6+tto","AudioManager",void 0);var j=r.ccclass,H=r.property;e("AudioManager",(m=j("AudioManager"),d=H({type:a}),h=H({type:l}),f=H({type:l}),S=H({type:l}),g=H({type:l}),V=H({type:l}),b=H({range:[0,1,.1]}),x=H({range:[0,1,.1]}),y=H({range:[0,1,.1]}),w=H({range:[0,1,.1]}),A=H({range:[0,1,.1]}),M=H({range:[0,1,.1]}),m((z=o((v=function(e){function o(){for(var o,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return o=e.call.apply(e,[this].concat(n))||this,u(o,"audioSource",z,t(o)),u(o,"bgmClip",P,t(o)),u(o,"pickupSound",C,t(o)),u(o,"placeSound",F,t(o)),u(o,"attackMergedSound",G,t(o)),u(o,"weaponSpawnSound",B,t(o)),u(o,"bgmVolume",D,t(o)),u(o,"sfxVolume",_,t(o)),u(o,"pickupVolume",L,t(o)),u(o,"placeVolume",R,t(o)),u(o,"attackMergedVolume",W,t(o)),u(o,"weaponSpawnVolume",X,t(o)),o.sfxAudioSource=null,o}i(o,e);var n=o.prototype;return n.start=function(){var e=this;c.addPersistRootNode(this.node),this.sfxAudioSource=this.node.addComponent(a),this.setBGMVolume(this.bgmVolume),this.setSFXVolume(this.sfxVolume),this.audioSource&&this.bgmClip?(this.audioSource.clip=this.bgmClip,this.audioSource.loop=!0,this.audioSource.play()):s.load("Sounds/full",l,(function(o,i){!o&&e.audioSource&&(e.audioSource.clip=i,e.audioSource.loop=!0,e.audioSource.play())}))},n.setBGMVolume=function(e){this.bgmVolume=Math.max(0,Math.min(1,e)),this.audioSource&&(this.audioSource.volume=this.bgmVolume)},n.setSFXVolume=function(e){this.sfxVolume=Math.max(0,Math.min(1,e)),this.sfxAudioSource&&(this.sfxAudioSource.volume=this.sfxVolume)},n.getBGMVolume=function(){return this.bgmVolume},n.getSFXVolume=function(){return this.sfxVolume},n.setPickupVolume=function(e){this.pickupVolume=Math.max(0,Math.min(1,e))},n.setPlaceVolume=function(e){this.placeVolume=Math.max(0,Math.min(1,e))},n.setAttackMergedVolume=function(e){this.attackMergedVolume=Math.max(0,Math.min(1,e))},n.setWeaponSpawnVolume=function(e){this.weaponSpawnVolume=Math.max(0,Math.min(1,e))},n.getPickupVolume=function(){return this.pickupVolume},n.getPlaceVolume=function(){return this.placeVolume},n.getAttackMergedVolume=function(){return this.attackMergedVolume},n.getWeaponSpawnVolume=function(){return this.weaponSpawnVolume},n.playPickupSound=function(){this.sfxAudioSource&&this.pickupSound&&(this.sfxAudioSource.clip=this.pickupSound,this.sfxAudioSource.loop=!1,this.sfxAudioSource.volume=this.pickupVolume*this.sfxVolume,this.sfxAudioSource.play())},n.playPlaceSound=function(){this.sfxAudioSource&&this.placeSound&&(this.sfxAudioSource.clip=this.placeSound,this.sfxAudioSource.loop=!1,this.sfxAudioSource.volume=this.placeVolume*this.sfxVolume,this.sfxAudioSource.play())},n.playAttackMergedSound=function(){this.sfxAudioSource&&this.attackMergedSound&&(this.sfxAudioSource.clip=this.attackMergedSound,this.sfxAudioSource.loop=!1,this.sfxAudioSource.volume=this.attackMergedVolume*this.sfxVolume,this.sfxAudioSource.play())},n.playWeaponSpawnSound=function(){this.sfxAudioSource&&this.weaponSpawnSound&&(this.sfxAudioSource.clip=this.weaponSpawnSound,this.sfxAudioSource.loop=!1,this.sfxAudioSource.volume=this.weaponSpawnVolume*this.sfxVolume,this.sfxAudioSource.play())},o}(p)).prototype,"audioSource",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P=o(v.prototype,"bgmClip",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),C=o(v.prototype,"pickupSound",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),F=o(v.prototype,"placeSound",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G=o(v.prototype,"attackMergedSound",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),B=o(v.prototype,"weaponSpawnSound",[V],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D=o(v.prototype,"bgmVolume",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),_=o(v.prototype,"sfxVolume",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),L=o(v.prototype,"pickupVolume",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),R=o(v.prototype,"placeVolume",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),W=o(v.prototype,"attackMergedVolume",[A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),X=o(v.prototype,"weaponSpawnVolume",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),k=v))||k));n._RF.pop()}}}));

System.register("chunks:///_virtual/BackpackManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Slot.ts"],(function(t){var e,o,r,i,n,a,l,s,c,p,u,h,d,g,f;return{setters:[function(t){e=t.applyDecoratedDescriptor,o=t.inheritsLoose,r=t.initializerDefineProperty,i=t.assertThisInitialized,n=t.createForOfIteratorHelperLoose},function(t){a=t.cclegacy,l=t._decorator,s=t.SpriteFrame,c=t.Node,p=t.Sprite,u=t.UITransform,h=t.Vec3,d=t.Vec2,g=t.Component},function(t){f=t.Slot}],execute:function(){var S,m,v,_,y,z,B;a._RF.push({},"00075B3Rf5MFLM8rZm+oHKx","BackpackManager",void 0);var C=l.ccclass,b=l.property;t("BackpackManager",(S=C("BackpackManager"),m=b(s),S((y=e((_=function(t){function e(){for(var e,o=arguments.length,n=new Array(o),a=0;a<o;a++)n[a]=arguments[a];return e=t.call.apply(t,[this].concat(n))||this,r(e,"slotSprite",y,i(e)),r(e,"slotSize",z,i(e)),r(e,"gap",B,i(e)),e}o(e,t);var a=e.prototype;return a.start=function(){this.createGrid(3,3)},a.createGrid=function(t,e){for(var o=-(e-1)*(this.slotSize+this.gap)/2,r=(t-1)*(this.slotSize+this.gap)/2,i=0;i<t;i++)for(var n=0;n<e;n++){var a=new c("Slot_"+i+"_"+n);a.addComponent(p).spriteFrame=this.slotSprite;var l=a.getComponent(u);l&&l.setContentSize(this.slotSize,this.slotSize),a.addComponent(f);var s=o+n*(this.slotSize+this.gap),d=r-i*(this.slotSize+this.gap);a.setPosition(new h(s,d,0)),this.node.addChild(a)}},a.getSlotAtWorldPosition=function(t){for(var e,o=null,r=1/0,i=n(this.node.children);!(e=i()).done;){var a=e.value,l=a.getComponent(u).getBoundingBoxToWorld();if(l.contains(new d(t.x,t.y)))return a;var s=new d(l.x+l.width/2,l.y+l.height/2),c=d.distance(s,new d(t.x,t.y));c<r&&(r=c,o=a)}return o&&r<.7*this.slotSize?o:null},a.getSlotsForWeapon=function(t,e){"1slot_merge"===e&&(e="1slot"),"3slot_merge"===e&&(e="3slot");var o=t.name.match(/Slot_(\d+)_(\d+)/);if(!o)return[];var r=parseInt(o[1]),i=parseInt(o[2]),n=[];if("1slot"===e||"rare"===e)n.push(t);else if("2slot"===e){var a=this.node.getChildByName("Slot_"+r+"_"+i),l=this.node.getChildByName("Slot_"+r+"_"+(i+1));a&&l&&n.push(a,l)}else if("3slot"===e){var s=this.node.getChildByName("Slot_"+r+"_"+i),c=this.node.getChildByName("Slot_"+(r+1)+"_"+i),p=this.node.getChildByName("Slot_"+(r+2)+"_"+i);s&&c&&p&&n.push(s,c,p)}return"2slot"===e&&2!==n.length||"3slot"===e&&3!==n.length?[]:n},e}(g)).prototype,"slotSprite",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),z=e(_.prototype,"slotSize",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),B=e(_.prototype,"gap",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),v=_))||v));a._RF.pop()}}}));

System.register("chunks:///_virtual/ButtonManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./WeaponManager.ts"],(function(t){var n,i,o,e,a,u,r,s,h,c,l,f,p;return{setters:[function(t){n=t.applyDecoratedDescriptor,i=t.inheritsLoose,o=t.initializerDefineProperty,e=t.assertThisInitialized},function(t){a=t.cclegacy,u=t._decorator,r=t.Node,s=t.find,h=t.Vec3,c=t.tween,l=t.Button,f=t.Component},function(t){p=t.WeaponManager}],execute:function(){var B,g,v,w,y,N,d;a._RF.push({},"29e19Qvh4BJW64CVxoK4TN3","ButtonManager",void 0);var M=u.ccclass,k=u.property;t("ButtonManager",(B=M("ButtonManager"),g=k(r),v=k(r),B((N=n((y=function(t){function n(){for(var n,i=arguments.length,a=new Array(i),u=0;u<i;u++)a[u]=arguments[u];return n=t.call.apply(t,[this].concat(a))||this,o(n,"fightButton",N,e(n)),o(n,"playNowButton",d,e(n)),n.weaponManager=null,n.lastBackpackState=!1,n}i(n,t);var a=n.prototype;return a.start=function(){var t=s("Canvas/WeaponManager");t&&(this.weaponManager=t.getComponent(p)),this.fightButton&&(this.fightButton.active=!1),this.disableButtonHover()},a.update=function(){if(this.weaponManager){var t=this.weaponManager.checkBackpackFull();t!==this.lastBackpackState&&(this.lastBackpackState=t,t?this.showFightButtonWithEffect():this.hideFightButton())}},a.showFightButtonWithEffect=function(){this.fightButton&&(this.fightButton.active=!0,this.fightButton.setScale(new h(0,0,1)),c(this.fightButton).to(.3,{scale:new h(1,1,1)}).start())},a.hideFightButton=function(){this.fightButton&&(this.fightButton.active=!1)},a.disableButtonHover=function(){if(this.fightButton){var t=this.fightButton.getComponent(l);t&&(t.transition=l.Transition.NONE,t.zoomScale=1)}if(this.playNowButton){var n=this.playNowButton.getComponent(l);n&&(n.transition=l.Transition.NONE,n.zoomScale=1)}},a.hideAllButtons=function(){this.fightButton&&(this.fightButton.active=!1),this.playNowButton&&(this.playNowButton.active=!1)},a.showAllButtons=function(){this.fightButton&&(this.fightButton.active=!0),this.playNowButton&&(this.playNowButton.active=!0)},n}(f)).prototype,"fightButton",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d=n(y.prototype,"playNowButton",[v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w=y))||w));a._RF.pop()}}}));

System.register("chunks:///_virtual/CanvasSize.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var n,e,r,o;return{setters:[function(t){n=t.inheritsLoose},function(t){e=t.cclegacy,r=t._decorator,o=t.Component}],execute:function(){var a;e._RF.push({},"91590dysHVG4apWMXDEmOiE","CanvasSize",void 0);var i=r.ccclass;r.property,t("CanvasSize",i("CanvasSize")(a=function(t){function e(){return t.apply(this,arguments)||this}n(e,t);var r=e.prototype;return r.start=function(){},r.update=function(t){},e}(o))||a);e._RF.pop()}}}));

System.register("chunks:///_virtual/LogoAnchorTopLeft.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(o){var t,e,n,r,i,c;return{setters:[function(o){t=o.inheritsLoose},function(o){e=o.cclegacy,n=o._decorator,r=o.view,i=o.UITransform,c=o.Component}],execute:function(){var s;e._RF.push({},"b6cd5gebx5KVY/5rvk44kuP","LogoAnchorTopLeft",void 0);var u=n.ccclass;o("LogoAnchorTopLeft",u("LogoAnchorTopLeft")(s=function(o){function e(){return o.apply(this,arguments)||this}return t(e,o),e.prototype.start=function(){var o=r.getDesignResolutionSize(),t=this.node.getComponent(i),e=t.width,n=t.height;this.node.setPosition(-o.width/2+e/2,o.height/2-n/2-5)},e}(c))||s);e._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./AudioManager.ts","./BackpackManager.ts","./ButtonManager.ts","./CanvasSize.ts","./LogoAnchorTopLeft.ts","./MergeEffectManager.ts","./Slot.ts","./Weapon.ts","./WeaponManager.ts"],(function(){return{setters:[null,null,null,null,null,null,null,null,null],execute:function(){}}}));

System.register("chunks:///_virtual/MergeEffectManager.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(e){var t,n,i,f,o,r,c;return{setters:[function(e){t=e.inheritsLoose},function(e){n=e.cclegacy,i=e._decorator,f=e.find,o=e.Animation,r=e.Vec3,c=e.Component}],execute:function(){var a;n._RF.push({},"b7bedZpruZD8ZhB2/w66YyL","MergeEffectManager",void 0);var s=i.ccclass;i.property,e("MergeEffectManager",s("MergeEffectManager")(a=function(e){function n(){for(var t,n=arguments.length,i=new Array(n),f=0;f<n;f++)i[f]=arguments[f];return(t=e.call.apply(e,[this].concat(i))||this).mergeEffectNode=null,t.animation=null,t.HIGH_Z_INDEX=100,t}t(n,e);var i=n.prototype;return i.start=function(){this.mergeEffectNode=f("Canvas/Backpack/MergeEffect"),this.mergeEffectNode&&(this.animation=this.mergeEffectNode.getComponent(o),this.mergeEffectNode.active=!1)},i.showMergeEffect=function(e,t){var n=this;if(void 0===t&&(t=200),this.mergeEffectNode){var i=new r(e.x,e.y,this.HIGH_Z_INDEX);this.mergeEffectNode.setPosition(i),this.mergeEffectNode.active=!0,this.animation&&this.animation.play&&this.animation.play(),setTimeout((function(){n.hideMergeEffect()}),t)}else console.warn("[MergeEffectManager] MergeEffect node not found!")},i.hideMergeEffect=function(){this.mergeEffectNode&&(this.mergeEffectNode.active=!1)},i.setZIndex=function(e){if(this.mergeEffectNode){var t=this.mergeEffectNode.getPosition();this.mergeEffectNode.setPosition(new r(t.x,t.y,e))}},i.getZIndex=function(){return this.mergeEffectNode?this.mergeEffectNode.getPosition().z:0},n}(c))||a);n._RF.pop()}}}));

System.register("chunks:///_virtual/Slot.ts",["./rollupPluginModLoBabelHelpers.js","cc"],(function(t){var c,n,o,e;return{setters:[function(t){c=t.inheritsLoose},function(t){n=t.cclegacy,o=t._decorator,e=t.Component}],execute:function(){var r;n._RF.push({},"dc7cccHYm5Iq6ItLMutJaT2","Slot",void 0);var u=o.ccclass;o.property,t("Slot",u("Slot")(r=function(t){function n(){for(var c,n=arguments.length,o=new Array(n),e=0;e<n;e++)o[e]=arguments[e];return(c=t.call.apply(t,[this].concat(o))||this).isOccupied=!1,c.occupyingWeapon=null,c}return c(n,t),n}(e))||r);n._RF.pop()}}}));

System.register("chunks:///_virtual/Weapon.ts",["./rollupPluginModLoBabelHelpers.js","cc","./BackpackManager.ts","./WeaponManager.ts","./Slot.ts","./AudioManager.ts"],(function(n){var e,o,a,t,i,r,c,s,p,g,l,d,u,h,f,k;return{setters:[function(n){e=n.inheritsLoose,o=n.createForOfIteratorHelperLoose},function(n){a=n.cclegacy,t=n._decorator,i=n.Node,r=n.find,c=n.Vec3,s=n.UITransform,p=n.Sprite,g=n.Color,l=n.instantiate,d=n.Component},function(n){u=n.BackpackManager},function(n){h=n.WeaponManager},function(n){f=n.Slot},function(n){k=n.AudioManager}],execute:function(){var v;a._RF.push({},"904b0ZFuPJEHbGvhP8xqw3v","Weapon",void 0);var M=t.ccclass;t.property,n("Weapon",M("Weapon")(v=function(n){function a(){for(var e,o=arguments.length,a=new Array(o),t=0;t<o;t++)a[t]=arguments[t];return(e=n.call.apply(n,[this].concat(a))||this).originalPosition=null,e.weaponManager=null,e.backpackManager=null,e.weaponId=0,e.initialIndex=0,e.weaponType="1slot",e.highlightedSlots=[],e.dragOffset=null,e.inBackpack=!1,e.slotsOccupied=[],e.audioManager=null,e}e(a,n);var t=a.prototype;return t.start=function(){this.node.on(i.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(i.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(i.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(i.EventType.TOUCH_CANCEL,this.onTouchEnd,this);var n=r("Canvas/WeaponManager");n&&(this.weaponManager=n.getComponent(h));var e=r("Canvas/Backpack");e&&(this.backpackManager=e.getComponent(u));var o=r("Canvas/AudioManager");o&&(this.audioManager=o.getComponent(k))},t.playPickupSound=function(){this.audioManager&&this.audioManager.playPickupSound()},t.playPlaceSound=function(){this.audioManager&&this.audioManager.playPlaceSound()},t.playAttackMergedSound=function(){this.audioManager&&this.audioManager.playAttackMergedSound()},t.onTouchStart=function(n){if(!this.weaponManager||!this.weaponManager.isLocked)if(this.weaponManager&&this.weaponManager.checkBackpackFull())this.weaponManager.setLockAndChargeEffect();else{this.playPickupSound(),this.originalPosition||(this.originalPosition=this.node.getPosition()),this.inBackpack&&this.slotsOccupied.length>0&&(this.slotsOccupied.forEach((function(n){var e=n.getComponent(f);e&&(e.isOccupied=!1)})),this.slotsOccupied=[]);var e=n.getUILocation?n.getUILocation():n.getLocation(),o=new c(e.x,e.y,0),a=this.node.getWorldPosition();this.dragOffset=a.subtract(o),this.inBackpack&&(this.node.setParent(this.weaponManager.node),this.inBackpack=!1)}},t.onTouchMove=function(n){var e=this;if((!this.weaponManager||!this.weaponManager.isLocked)&&this.backpackManager){var a=n.getUILocation?n.getUILocation():n.getLocation(),t=new c(a.x,a.y,0),i=this.node.parent.getWorldPosition(),r=t.add(this.dragOffset||new c).subtract(i);this.node.setPosition(r);var l=this.node.getComponent(s).getBoundingBoxToWorld();this.highlightedSlots.forEach((function(n){var e=n.getComponent(p);e&&(e.color=g.WHITE)})),this.highlightedSlots=[];for(var d,u=o(this.backpackManager.node.children);!(d=u()).done;){var h=d.value,k=h.getComponent(s).getBoundingBoxToWorld();if(l.intersects(k)){var v=this.backpackManager.getSlotsForWeapon(h,this.weaponType);if(v.length>0){var M=v.some((function(n){var o=n.getComponent(f);return o&&o.occupyingWeapon&&o.occupyingWeapon!==e}));if(v.every((function(n){var e=n.getComponent(f);return e&&!e.isOccupied}))){v.forEach((function(n){var e=n.getComponent(p);e&&(e.color=g.GREEN)})),this.highlightedSlots=v;break}if(M){v.forEach((function(n){var e=n.getComponent(p);e&&(e.color=g.RED)})),this.highlightedSlots=v;break}}}}}},t.onTouchEnd=function(n){var e=this;if(!this.weaponManager||!this.weaponManager.isLocked)if(this.highlightedSlots.forEach((function(n){var e=n.getComponent(p);e&&(e.color=g.WHITE)})),this.highlightedSlots=[],this.backpackManager){for(var t,i=n.getUILocation?n.getUILocation():n.getLocation(),d=(new c(i.x,i.y,0),this.node.getComponent(s).getBoundingBoxToWorld()),u=!1,h=function(){var n=t.value,o=n.getComponent(s).getBoundingBoxToWorld();if(d.intersects(o)){var i=e.backpackManager.getSlotsForWeapon(n,e.weaponType);if(i.length>0&&i.every((function(n){return n.getComponent(f)}))){var g=new Set,h=!1,k="",v=null;if(i.forEach((function(n){var o=n.getComponent(f);o&&o.occupyingWeapon&&o.occupyingWeapon!==e&&("1slot"===e.weaponType&&"1slot"===o.occupyingWeapon.weaponType||"3slot"===e.weaponType&&"3slot"===o.occupyingWeapon.weaponType?(h=!0,k="1slot"===e.weaponType?"1slot_merge":"3slot_merge",v=n,g.add(o.occupyingWeapon)):g.add(o.occupyingWeapon))})),h&&v){if(g.forEach((function(n){var e=n,o=e.node;e.slotsOccupied&&e.slotsOccupied.forEach((function(n){var e=n.getComponent(f);e&&(e.isOccupied=!1,e.occupyingWeapon=null)})),o.setParent(null),o.destroy()})),e.slotsOccupied&&e.slotsOccupied.forEach((function(n){var e=n.getComponent(f);e&&(e.isOccupied=!1,e.occupyingWeapon=null)})),e.node.setParent(null),e.node.destroy(),e.weaponManager){var M="";"1slot_merge"===k&&(M="weapon_1slot_merge"),"3slot_merge"===k&&(M="weapon_3slot_merge");var w=e.weaponManager.weaponSprites.find((function(n){return n.name===M}));if(w){var y=l(e.weaponManager.weaponPrefab),m=y.getComponent(a);m.weaponType=k,m.weaponManager=e.weaponManager,m.backpackManager=e.backpackManager,y.getComponent(p).spriteFrame=w;var P=[v];if("3slot_merge"===k){var W=99,C=0;i.forEach((function(n){var e=n.name.match(/Slot_(\d+)_(\d+)/);if(e){var o=parseInt(e[1]);C=parseInt(e[2]),o<W&&(W=o)}})),P=[e.backpackManager.node.getChildByName("Slot_"+W+"_"+C),e.backpackManager.node.getChildByName("Slot_"+(W+1)+"_"+C),e.backpackManager.node.getChildByName("Slot_"+(W+2)+"_"+C)].filter(Boolean)}var S=P[0].getWorldPosition(),T=P[P.length-1].getWorldPosition(),O=S.add(T).multiplyScalar(.5),E=e.backpackManager.node.getWorldPosition(),b=O.subtract(E);y.setParent(e.backpackManager.node),y.setPosition(b);var B=y.getComponent(s),_=70,I=70;"1slot_merge"===k?(_=e.weaponManager.weaponWidths[6]||70,I=e.weaponManager.weaponHeights[6]||70):"3slot_merge"===k&&(_=e.weaponManager.weaponWidths[7]||70,I=e.weaponManager.weaponHeights[7]||220),B&&B.setContentSize(_,I);var L=v.getComponent(f);L&&(L.isOccupied=!0,L.occupyingWeapon=m),m.inBackpack=!0,m.slotsOccupied=[v];var x=r("Canvas/Backpack/MergeEffect");if(x&&y){x.active=!0;var H=y.getPosition(),A=new c(H.x,H.y,999);x.setPosition(A),x.setScale(new c(1,1,1));var U=x.getComponent("cc.Animation");U&&U.play&&U.play(),setTimeout((function(){x.active=!1}),400),e.playAttackMergedSound()}}}return u=!0,0}g.forEach((function(n){var o=n;o.node&&o.node.isValid&&(o.slotsOccupied&&o.slotsOccupied.forEach((function(n){var e=n.getComponent(f);e&&(e.isOccupied=!1,e.occupyingWeapon=null)})),o.node.setParent(e.weaponManager.node),o.inBackpack=!1,o.slotsOccupied=[])})),e.updateWeaponsInStockPosition(),i.forEach((function(n){var o=n.getComponent(f);o&&(o.isOccupied=!0,o.occupyingWeapon=e)}));var F=i[0].getWorldPosition(),N=i[i.length-1].getWorldPosition(),R=F.add(N).multiplyScalar(.5),V=e.backpackManager.node.getWorldPosition(),z=R.subtract(V);if(e.node.setParent(e.backpackManager.node),e.node.setPosition(z),e.inBackpack=!0,e.slotsOccupied=i,e.playPlaceSound(),e.weaponManager){var D=e.weaponManager.node.children.map((function(n){var e=n.getComponent(a);return e?e.weaponType:null})).filter((function(n){return null!==n})),G=["1slot","2slot","3slot","rare"].filter((function(n){return-1===D.map(String).indexOf(String(n))}));if(G.length>0){var j=G[Math.floor(Math.random()*G.length)],q=0;q="1slot"===j?0:"2slot"===j?1:"3slot"===j?2:3,e.weaponManager.spawnNewWeapon(q)}}return u=!0,0}}},k=o(this.backpackManager.node.children);!(t=k()).done&&0!==h(););if(!u)if(this.slotsOccupied.length>0){var v=this.slotsOccupied[0].getWorldPosition(),M=this.slotsOccupied[this.slotsOccupied.length-1].getWorldPosition(),w=v.add(M).multiplyScalar(.5),y=this.backpackManager.node.getWorldPosition(),m=w.subtract(y);this.node.setParent(this.backpackManager.node),this.node.setPosition(m),this.inBackpack=!0}else this.originalPosition&&this.node.setPosition(this.originalPosition);this.updateWeaponsInStockPosition()}else this.originalPosition&&this.node.setPosition(this.originalPosition)},t.updateWeaponsInStockPosition=function(){var n=this;if(this.weaponManager){var e=this.weaponManager.node.children.filter((function(n){var e=n.getComponent(a);return e&&!e.inBackpack&&n.activeInHierarchy&&n.isValid}));e.forEach((function(o,a){var t=(a-(e.length-1)/2)*(n.weaponManager.weaponSize+n.weaponManager.gap);o.setPosition(new c(t,-250,0))}))}},a}(d))||v);a._RF.pop()}}}));

System.register("chunks:///_virtual/WeaponManager.ts",["./rollupPluginModLoBabelHelpers.js","cc","./Weapon.ts","./AudioManager.ts"],(function(e){var n,t,a,o,i,r,s,p,l,c,u,h,d,f,w,g,v,m,C,y;return{setters:[function(e){n=e.applyDecoratedDescriptor,t=e.inheritsLoose,a=e.initializerDefineProperty,o=e.assertThisInitialized},function(e){i=e.cclegacy,r=e._decorator,s=e.Prefab,p=e.SpriteFrame,l=e.find,c=e.instantiate,u=e.Sprite,h=e.UITransform,d=e.Vec3,f=e.Node,w=e.Color,g=e.UIOpacity,v=e.tween,m=e.Component},function(e){C=e.Weapon},function(e){y=e.AudioManager}],execute:function(){var W,b,S,z,M,P,k,T,_,x,B,N,L;i._RF.push({},"3a0044yZz5ETLZ5h8YqSKnL","WeaponManager",void 0);var E=r.ccclass,I=r.property;e("WeaponManager",(W=E("WeaponManager"),b=I(s),S=I([p]),z=I([Number]),M=I([Number]),W((T=n((k=function(e){function n(){for(var n,t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return n=e.call.apply(e,[this].concat(i))||this,a(n,"weaponPrefab",T,o(n)),a(n,"weaponSprites",_,o(n)),a(n,"weaponWidths",x,o(n)),a(n,"weaponHeights",B,o(n)),a(n,"weaponSize",N,o(n)),a(n,"gap",L,o(n)),n.weaponCount=0,n.maxWeapons=6,n.isLocked=!1,n.loadDelay=1,n.audioManager=null,n}t(n,e);var i=n.prototype;return i.start=function(){this.createInitialWeapons();var e=l("Canvas/AudioManager");e&&(this.audioManager=e.getComponent(y))},i.createInitialWeapons=function(){for(var e=0;e<3;e++)this.createWeapon(e)},i.createWeapon=function(e){var n,t=this;if(!(this.weaponCount>=this.maxWeapons)){var a=c(this.weaponPrefab),o=a.getComponent(C);o.weaponId=this.weaponCount,o.initialIndex=e;var i="1slot",r=a.getComponent(u);r.spriteFrame=this.weaponSprites[this.weaponCount%this.weaponSprites.length];var s=(null==(n=r.spriteFrame)?void 0:n.name)||"";s.includes("weapon_1slot")?i="1slot":s.includes("weapon_2slot")?i="2slot":s.includes("weapon_3slot")?i="3slot":s.includes("weapon_rare")&&(i="rare"),o.weaponType=i;var p=a.getComponent(h),m=this.weaponWidths[this.weaponCount%this.weaponWidths.length]||this.weaponSize,y=this.weaponHeights[this.weaponCount%this.weaponHeights.length]||this.weaponSize;p&&p.setContentSize(m,y);var W=(e-1)*(this.weaponSize+this.gap);a.setPosition(new d(W,-250,0)),this.node.addChild(a),this.weaponCount>=3&&setTimeout((function(){var e=l("Canvas/GenWeaponEffect");if(!e){var n=l("Canvas");n&&(e=n.getChildByName("GenWeaponEffect"))}if(e){e.active=!0;var o=a.getWorldPosition(),i=l("Canvas");if(i){var r=i.getWorldPosition(),s=new d(o.x-r.x,o.y-r.y,999);e.setPosition(s)}else{var p=new d(o.x,o.y,999);e.setPosition(p)}var c=e.getComponent("cc.Animation");c&&c.play&&c.play(),setTimeout((function(){e.active=!1}),500)}else{var g=l("Canvas");if(g){var v=new f("GenWeaponEffect"),m=v.addComponent(u);v.addComponent(h).setContentSize(100,100),m.color=new w(255,0,0,255),g.addChild(v),v.setPosition(new d(0,0,999)),v.active=!1}}t.audioManager&&t.audioManager.playWeaponSpawnSound()}),0),a.setScale(new d(.5,.5,1));var b=a.getComponent(g);b||(b=a.addComponent(g)),b.opacity=0,v(a).to(.3,{scale:new d(1,1,1)}).start(),v(b).to(.3,{opacity:255}).start(),p&&p.setContentSize(m,y),this.weaponCount++}},i.spawnNewWeapon=function(e){this.weaponCount<this.maxWeapons&&this.createWeapon(e)},i.checkBackpackFull=function(){var e;if(!this.node.scene)return!1;var n=null==(e=this.node.scene.getChildByName("Canvas"))?void 0:e.getChildByName("Backpack");if(!n)return!1;var t=["2slot","rare","3slot_merge","1slot_merge"],a=new Set;return n.children.forEach((function(e){if(e&&e.isValid){var n=e.getComponent("Weapon");n&&"string"==typeof n.weaponType&&-1!==t.indexOf(n.weaponType)&&a.add(n.weaponType)}})),4===a.size},i.sequentialLoadWeapons=function(e,n){var t=this,a=void 0!==n?n:this.loadDelay,o=0;!function n(){o>=e.length||(t.createWeapon(e[o]),++o<e.length&&setTimeout(n,1e3*a))}()},i.setLockAndChargeEffect=function(){var e;this.isLocked=!0;var n=null==(e=this.node.scene.getChildByName("Canvas"))?void 0:e.getChildByName("Backpack");n&&n.children.forEach((function(e){if(e&&e.isValid){var n=e.getComponent(u);n&&(n.color=new w(80,80,80,255),v(n).to(1,{color:new w(255,255,255,255)}).start())}}))},n}(m)).prototype,"weaponPrefab",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_=n(k.prototype,"weaponSprites",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),x=n(k.prototype,"weaponWidths",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[70,160,70]}}),B=n(k.prototype,"weaponHeights",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[70,40,220]}}),N=n(k.prototype,"weaponSize",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),L=n(k.prototype,"gap",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),P=k))||P));i._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});